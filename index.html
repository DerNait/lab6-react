<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>DerNait's Card Game</title>

	<link
		href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
		rel="stylesheet"
	/>

	<script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
	<script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
	<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

	<style>
		/* GRID */
		.grid-container {
			gap: 10px;
		}

		/* CARTA */   
		.memory-card {
			perspective: 1000px;
			width: 100px;
			height: 100px;
			cursor: pointer;
		}
		.card-inner {
			position: relative;
			width: 100%;
			height: 100%;
			transform-style: preserve-3D;
			transition: transform 0.6s;
		}
		.card-inner.flipped {
			transform: rotateY(180deg) scale(1.05);
			animation: bounce 0.3s;
		}
		.card-face {
			position: absolute;
			width: 100%;
			height: 100%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 2rem;
			border-radius: 0.5rem;
			box-shadow: 0 2px 5px rgba(0,0,0,0.3);
			backface-visibility: hidden;
		}
		.card-front {
			background: #0d6efd;
			color: #fff;
		}
		.card-back {
			background: #fff;
			transform: rotateY(180deg);
		}
		@keyframes bounce {
			0%, 100% { transform: rotateY(180deg) scale(1); }
			50%     { transform: rotateY(180deg) scale(1.1); }
		}
	</style>
</head>
<body>
	<div id="root"></div>

	<script type="text/babel">
		const { useState, useEffect } = React;

		function Card({ value, isFlipped, isMatched, onClick }) {
			return (
			<div className="memory-card" onClick={onClick}>
				<div className={"card-inner" + ((isFlipped || isMatched) ? " flipped" : "")}>
					<div className="card-face card-front">?</div>
					<div className="card-face card-back">{value}</div>
				</div>
			</div>
			);
		}

		function Grid({ rows, cols, children }) {
			const rowsNumber = Math.max(2, rows);
			const colsNumber = Math.max(2, cols);
			const style = {
				display: "grid",
				gridTemplateRows: `repeat(${rowsNumber}, 1fr)`,
				gridTemplateColumns: `repeat(${colsNumber}, 1fr)`
			};

			return <div className="grid-container" style={style}>{children}</div>;
		}

		function App() {
			const rows = 4, cols = 4;
			const uniqueVals = ['🐶','🐱','🐭','🐹','🐰','🦊','🐻','🐼'];

			const [cards, setCards]		= useState([]);
			const [flipped, setFlipped] = useState([]);
			const [matched, setMatched] = useState([]);
			const [moves, setMoves]		= useState(0);
			const [busy, setBusy]		= useState(false);
			const [showAll, setShowAll] = useState(true);

			useEffect(() => {
				startGame();
			}, []);

			const handleClick = id => {
				if (busy || flipped.includes(id) || matched.includes(id) || showAll) {
					return;
				} 

				const newFlip = [...flipped, id];
				setFlipped(newFlip);

				if (newFlip.length === 2) {
					setBusy(true);
					setMoves(moves => moves + 1);
					const [i,j] = newFlip;

					if (cards[i] === cards[j]) {
						setMatched(matched => [...matched, i, j]);
						resetTurn();
					} else {
						setTimeout(resetTurn, 1000);
					}
				}
			};

			const startGame = () => {
				const deck = [...uniqueVals, ...uniqueVals].sort(() => Math.random()-0.5);
				setCards(deck);
				setTimeout(() => setShowAll(false), 1500);
			}

			const resetTurn = () => {
				setFlipped([]);
				setBusy(false);
			};

			const resetGame = () => {
				setMatched([]);
				setMoves(0);
				setShowAll(true);

				startGame();
			};

			const won = matched.length === cards.length;

			return (
			<div className="container text-center mt-4">
				<h1>Memoria</h1>
				<p>Movimientos: {moves}</p>

				{won &&
					<div className="alert alert-success">
						¡Ganaste! 
						<button className="btn btn-sm btn-primary ms-2" onClick={resetGame}>
						Jugar de nuevo
						</button>
					</div>
				}

				<Grid rows={rows} cols={cols}>
					{cards.map((value, index) =>
						<Card
							key={index}
							value={value}
							isFlipped={showAll || flipped.includes(index)}
							isMatched={matched.includes(index)}
							onClick={() => handleClick(index)}
						/>
					)}
				</Grid>
			</div>
			);
		}

		const root = ReactDOM.createRoot(document.getElementById('root'));
		root.render(<App />);
		
	</script>
</body>
</html>